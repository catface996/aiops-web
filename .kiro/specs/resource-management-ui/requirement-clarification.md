# 需求澄清文档

**功能名称**: F03 - 创建和管理IT资源（前端）  
**创建日期**: 2024-11-30  
**需求分析师**: AI Assistant  
**状态**: 已澄清 ✅

---

## 1. 需求概述

### 1.1 核心需求（3-5句话）

作为AIOps平台的前端应用，需要为IT资源管理提供完整的用户界面。用户（运维工程师）需要通过Web界面创建、查看、编辑、删除和管理各种类型的IT资源（服务器、应用、数据库、接口、中间件、报表）。界面需要友好、响应快速，支持搜索、过滤、排序等功能，并严格控制权限（Owner/Viewer）。前端基于React + TypeScript + Ant Design技术栈实现，与后端RESTful API交互。

### 1.2 业务目标

**Why - 为什么需要这个功能？**

- **业务价值**: 
  - 提供统一的资源管理入口，提升运维效率
  - 降低资源管理的学习成本，提供一致的用户体验
  - 支持多种资源类型，满足复杂IT环境的管理需求
  
- **解决的痛点**:
  - 当前缺少统一的资源管理界面，运维人员需要使用多个工具
  - 资源信息分散，难以快速查找和管理
  - 权限控制不清晰，容易误操作
  
- **预期成果**:
  - 运维工程师可以在一个界面完成所有资源管理操作
  - 资源创建时间从平均5分钟降低到2分钟
  - 资源查找时间从平均1分钟降低到10秒

### 1.3 用户角色

**Who - 谁使用这个功能？**

| 角色 | 职责 | 使用场景 | 权限要求 |
|------|------|----------|----------|
| 运维工程师 | 创建和管理IT资源 | 日常资源录入、更新、查询 | Owner权限（自己创建的资源） |
| 系统管理员 | 管理所有资源 | 资源审核、批量管理 | 所有资源的Owner权限 |
| 开发人员 | 查看资源信息 | 查询资源配置、连接信息 | Viewer权限 |
| 团队Leader | 查看团队资源 | 资源概览、状态监控 | Viewer权限 |

---

## 2. 澄清结果

### 2.1 功能范围澄清

**What - 具体需要做什么？**

| 功能点 | 原始描述 | 澄清后的精确描述 | 优先级 |
|--------|----------|------------------|--------|
| 资源创建 | 创建各种类型的资源 | 提供两步式创建流程：1)选择资源类型 2)填写表单。支持6种预置类型，每种类型有不同的扩展字段。表单需要实时验证，敏感字段需要特殊处理 | Must |
| 资源列表 | 查看资源列表 | 三栏布局：左侧过滤器、中间表格、右上搜索。支持分页（默认20条/页）、搜索（名称模糊匹配）、过滤（类型、标签、状态）、排序（名称、创建时间、更新时间） | Must |
| 资源详情 | 查看资源详细信息 | Tab页签式布局，包含6个Tab：概览、配置、拓扑、Agent、任务、权限。敏感信息需要权限控制（Owner可见，Viewer不可见） | Must |
| 资源编辑 | 编辑资源信息 | 仅Owner可编辑。支持原地编辑（Descriptions切换为Form）。需要处理并发冲突（乐观锁version字段）。敏感字段需要重新输入 | Must |
| 资源删除 | 删除资源 | 仅Owner可删除。需要两步确认：1)检查关联关系 2)输入资源名称确认。删除后跳转到列表页 | Must |
| 状态管理 | 更新资源状态 | 支持4种状态：运行中、已停止、维护中、已下线。Owner可以快速切换状态（列表页下拉菜单、详情页选择器）。状态用不同颜色的徽章展示 | Must |
| 批量操作 | 批量删除资源 | 列表页支持多选，显示批量操作工具栏。仅当所有选中资源都有删除权限时才显示批量删除按钮 | Should |


### 2.2 触发条件和时机

**When - 什么时候触发？**

| 功能 | 触发条件 | 触发时机 | 频率 |
|------|----------|----------|------|
| 资源创建 | 用户点击"创建资源"按钮 | 需要录入新资源时 | 每天10-50次（取决于团队规模） |
| 资源列表加载 | 用户访问资源管理页面 | 页面首次加载、刷新、过滤、搜索、排序、分页切换 | 每天100-500次 |
| 资源详情加载 | 用户点击资源名称 | 需要查看资源详细信息时 | 每天50-200次 |
| 资源编辑 | Owner点击"编辑"按钮 | 资源信息需要更新时 | 每天5-20次 |
| 资源删除 | Owner点击"删除"按钮 | 资源不再需要时 | 每天1-5次 |
| 状态切换 | Owner点击状态徽章或选择器 | 资源状态变化时（如维护、下线） | 每天10-30次 |
| 搜索 | 用户在搜索框输入关键词 | 需要快速定位资源时 | 每天30-100次 |
| 过滤 | 用户选择过滤器选项 | 需要查看特定类型或标签的资源时 | 每天20-80次 |

### 2.3 使用环境和场景

**Where - 在哪里使用？**

- **使用环境**: 
  - 企业内网环境（主要）
  - 公网环境（VPN接入）
  - 办公室、家庭、移动办公场所

- **设备要求**:
  - 桌面端：Windows/macOS/Linux
  - 屏幕分辨率：≥1200px宽度（最佳体验）
  - 平板端：iPad等（基本可用）
  - 移动端：手机（可选支持）

- **浏览器要求**:
  - Chrome ≥90（推荐）
  - Firefox ≥88
  - Safari ≥14
  - Edge ≥90
  - 不支持IE

- **网络要求**:
  - 内网：100Mbps+
  - 外网：10Mbps+
  - 延迟：<100ms（最佳）

### 2.4 实现方法和验收标准

**How - 如何实现？如何验证？**

#### 2.4.1 资源创建流程

**实现要点**:
- 使用Ant Design Modal展示类型选择器
- 使用Ant Design Form组件构建表单
- 根据资源类型动态渲染扩展字段
- 使用Ant Design Form.Item的rules进行实时验证
- 敏感字段使用Input.Password组件
- 提交时调用POST /api/v1/resources API

**验收标准**:
- [ ] 点击"创建资源"按钮后，弹出类型选择对话框
- [ ] 对话框展示6种资源类型，每种有图标、名称、描述
- [ ] 选择类型后，显示对应的创建表单
- [ ] 表单包含基本信息字段（名称、描述、标签）
- [ ] 表单根据类型动态显示扩展字段
- [ ] 名称字段验证：2-100字符，必填
- [ ] 描述字段验证：最多500字符，可选
- [ ] 标签字段验证：最多10个，可选
- [ ] 敏感字段（password/secret/key）使用密码输入框
- [ ] 验证失败时显示红色错误提示
- [ ] 点击"创建"后显示loading状态
- [ ] 创建成功后显示成功提示并跳转到详情页
- [ ] 创建失败后显示错误提示并保持表单数据

#### 2.4.2 资源列表展示

**实现要点**:
- 使用Ant Design Layout组件实现三栏布局
- 使用Ant Design Table组件展示列表
- 使用Ant Design Pagination组件实现分页
- 使用Ant Design Input.Search组件实现搜索
- 使用Ant Design Radio.Group和Checkbox.Group实现过滤器
- 搜索使用lodash.debounce实现300ms防抖

**验收标准**:
- [ ] 页面采用三栏布局：左侧过滤器（240px）、中间列表（自适应）
- [ ] 表格展示列：名称、类型、状态、标签、创建时间、更新时间、操作
- [ ] 名称列可点击，跳转到详情页
- [ ] 类型列显示图标+文字
- [ ] 状态列使用Badge组件，不同状态不同颜色
- [ ] 标签列使用Tag组件，最多显示3个，超过显示"+N"
- [ ] 时间列格式化为"YYYY-MM-DD HH:mm"
- [ ] 操作列根据权限显示编辑、删除按钮
- [ ] 分页默认20条/页，支持切换10/20/50/100
- [ ] 搜索框输入后300ms触发搜索
- [ ] 搜索结果高亮显示匹配关键词
- [ ] 类型过滤器显示6种类型+全部选项
- [ ] 标签过滤器显示所有已使用的标签，支持多选
- [ ] 状态过滤器显示4种状态，支持多选
- [ ] 表格支持按名称、创建时间、更新时间排序
- [ ] 列表加载时显示Spin组件
- [ ] 无数据时显示Empty组件


#### 2.4.3 资源详情展示

**实现要点**:
- 使用Ant Design PageHeader组件展示顶部信息
- 使用Ant Design Tabs组件实现Tab切换
- 使用Ant Design Descriptions组件展示详情
- 敏感信息默认隐藏，Owner可点击"显示"按钮查看
- Tab切换时更新URL参数（?tab=overview）

**验收标准**:
- [ ] 顶部显示面包屑导航：资源管理 > 资源详情
- [ ] 标题区显示：资源名称、类型图标、状态徽章
- [ ] 操作区根据权限显示：编辑、删除、刷新按钮
- [ ] Tab页签包含：概览、配置、拓扑、Agent、任务、权限
- [ ] 概览Tab展示基本信息：名称、类型、状态、描述、标签、时间、创建者
- [ ] 配置Tab展示扩展属性，根据资源类型不同
- [ ] 敏感字段默认显示"***"
- [ ] Owner可以点击"显示"按钮查看明文
- [ ] 明文显示3秒后自动隐藏
- [ ] 非Owner不显示"显示"按钮
- [ ] 权限Tab展示Owner和Viewer列表
- [ ] Tab切换时URL参数同步更新
- [ ] 详情页加载时间<500ms

#### 2.4.4 资源编辑流程

**实现要点**:
- 点击"编辑"按钮后，Descriptions组件切换为Form组件
- 表单预填充当前资源信息
- 提交时包含version字段（乐观锁）
- 处理并发冲突（version不匹配）

**验收标准**:
- [ ] Owner可以看到"编辑"按钮
- [ ] 非Owner看不到"编辑"按钮
- [ ] 点击"编辑"后进入编辑模式
- [ ] 所有字段变为可编辑状态
- [ ] 表单预填充当前值
- [ ] 敏感字段显示为"***"，需要重新输入
- [ ] 底部显示"保存"和"取消"按钮
- [ ] 点击"保存"后显示loading状态
- [ ] 更新成功后显示成功提示并退出编辑模式
- [ ] 更新冲突时显示对话框提示刷新
- [ ] 点击"取消"时，如果有修改则弹出确认对话框
- [ ] 确认后退出编辑模式

#### 2.4.5 资源删除流程

**实现要点**:
- 先调用API检查关联关系
- 如果有关联，显示关联信息对话框
- 显示二次确认对话框，要求输入资源名称
- 只有输入完全匹配时才能确认删除

**验收标准**:
- [ ] Owner可以看到"删除"按钮
- [ ] 非Owner看不到"删除"按钮
- [ ] 点击"删除"后先检查关联关系
- [ ] 如果有关联，显示关联信息对话框
- [ ] 关联信息分区域展示：拓扑关系、Agent关联、任务关联
- [ ] 提供"继续删除"和"取消"按钮
- [ ] 点击"继续删除"后显示二次确认对话框
- [ ] 对话框要求输入资源名称确认
- [ ] 只有输入完全匹配时"确认"按钮才可用
- [ ] 点击"确认"后显示loading状态
- [ ] 删除成功后显示成功提示并跳转到列表页
- [ ] 删除失败后显示错误提示

### 2.5 性能和质量指标

**How Much - 具体指标是多少？**

| 指标类型 | 指标名称 | 目标值 | 测量方法 |
|---------|---------|--------|----------|
| 性能 | 页面首次加载时间 | <2秒 | Chrome DevTools Performance |
| 性能 | 列表查询响应时间 | <1秒 | Network面板查看API响应时间 |
| 性能 | 搜索响应时间 | <500ms | Network面板查看API响应时间 |
| 性能 | 详情页加载时间 | <500ms | Chrome DevTools Performance |
| 性能 | 表单提交响应时间 | <1秒 | Network面板查看API响应时间 |
| 性能 | 1000条数据渲染时间 | <500ms | React DevTools Profiler |
| 质量 | 可用性 | 99.9% | 监控系统统计 |
| 质量 | 错误率 | <0.1% | 错误日志统计 |
| 质量 | 测试覆盖率 | ≥70% | Vitest coverage报告 |
| 用户体验 | 操作成功率 | ≥95% | 用户行为分析 |
| 用户体验 | 任务完成时间 | 创建资源<2分钟 | 用户测试 |
| 用户体验 | 学习成本 | 新用户<10分钟上手 | 用户测试 |

---

## 3. 歧义澄清记录

### 3.1 已澄清的歧义

| ID | 歧义表述 | 提出的问题 | 澄清结果 | 影响范围 |
|----|---------|-----------|---------|---------|
| CL-001 | "友好的界面" | 什么是"友好"？有具体标准吗？ | 使用Ant Design组件库，遵循Material Design原则，操作步骤不超过3步，错误提示清晰明确 | UI设计、交互设计 |
| CL-002 | "快速响应" | "快速"的具体指标是多少？ | 列表查询<1秒，搜索<500ms，详情页<500ms，表单提交<1秒 | 性能优化、API设计 |
| CL-003 | "敏感信息" | 哪些字段属于敏感信息？ | 字段名包含"password"、"secret"、"key"的字段，以及数据库连接信息中的密码 | 表单设计、权限控制 |
| CL-004 | "权限控制" | Owner和Viewer的具体权限是什么？ | Owner：查看、编辑、删除、管理权限；Viewer：仅查看（不包括敏感信息） | 权限系统、UI显示 |
| CL-005 | "实时搜索" | 是否需要防抖？延迟多少？ | 需要防抖，300ms延迟，避免频繁请求 | 搜索功能实现 |
| CL-006 | "批量操作" | 批量操作包括哪些？ | MVP阶段只支持批量删除，未来可能扩展批量编辑、批量导出 | 功能范围 |
| CL-007 | "移动端支持" | 是否需要支持移动端？ | 移动端为COULD优先级，桌面端为MUST，平板端为SHOULD | 响应式设计 |

### 3.2 识别并消除的歧义

| ID | 歧义表述 | 可能理解A | 可能理解B | 最终确认 |
|----|---------|----------|----------|---------|
| AM-001 | "资源类型" | 用户可以自定义资源类型 | 只支持6种预置类型 | MVP阶段只支持6种预置类型，未来版本支持自定义 |
| AM-002 | "标签过滤" | 标签过滤是OR逻辑（满足任一标签） | 标签过滤是AND逻辑（同时满足所有标签） | 使用AND逻辑，更符合精确筛选的需求 |
| AM-003 | "删除确认" | 只需要一次确认 | 需要两次确认 | 需要两次确认：1)检查关联 2)输入名称确认 |
| AM-004 | "敏感信息显示" | Owner可以一直看到明文 | Owner点击后显示3秒自动隐藏 | 显示3秒后自动隐藏，提高安全性 |
| AM-005 | "编辑模式" | 跳转到新页面编辑 | 原地切换为编辑模式 | 原地切换，减少页面跳转，提升体验 |

---

## 4. 关键假设

| ID | 假设内容 | 依据 | 验证方法 | 验证时间 | 状态 |
|----|---------|------|----------|---------|--------|
| AS-001 | 后端API已经实现并可用 | 后端需求文档已完成 | 调用API测试 | 开发前 | 待验证 |
| AS-002 | 用户浏览器支持ES2015+ | 现代企业环境 | 浏览器兼容性测试 | 测试阶段 | 待验证 |
| AS-003 | 单个资源的扩展属性不超过20个字段 | 后端数据模型设计 | 查看后端schema | 设计阶段 | 待验证 |
| AS-004 | 用户网络环境稳定，延迟<100ms | 企业内网环境 | 网络测试 | 部署后 | 待验证 |
| AS-005 | 用户熟悉基本的Web操作 | 目标用户为运维工程师 | 用户测试 | 测试阶段 | 待验证 |
| AS-006 | Ant Design 5.x组件库满足所有UI需求 | Ant Design文档调研 | 原型设计 | 设计阶段 | 待验证 |
| AS-007 | 资源列表不会超过10000条 | 后端性能要求 | 性能测试 | 测试阶段 | 待验证 |
| AS-008 | 用户不会频繁切换资源类型 | 用户行为分析 | 用户行为监控 | 上线后 | 待验证 |


**关键假设详细说明**:

1. **AS-001: 后端API已经实现并可用**
   - 内容：前端开发依赖后端提供完整的RESTful API，包括资源CRUD、权限验证、关联关系查询等
   - 假设不成立的影响：前端无法进行集成测试，可能需要Mock数据开发
   - 缓解策略：与后端团队确认API开发进度，准备Mock Server作为备选方案

2. **AS-002: 用户浏览器支持ES2015+**
   - 内容：假设用户使用的浏览器支持现代JavaScript特性（箭头函数、Promise、async/await等）
   - 假设不成立的影响：需要添加Polyfill，增加打包体积
   - 缓解策略：使用Vite的自动Polyfill功能，配置browserslist

3. **AS-003: 单个资源的扩展属性不超过20个字段**
   - 内容：假设每种资源类型的扩展属性字段数量在合理范围内
   - 假设不成立的影响：表单过长，用户体验差，可能需要分步表单
   - 缓解策略：如果字段过多，采用分组或分步表单设计

4. **AS-007: 资源列表不会超过10000条**
   - 内容：假设单个用户可见的资源数量在10000条以内
   - 假设不成立的影响：列表性能下降，需要虚拟滚动或更激进的分页策略
   - 缓解策略：实现虚拟滚动，优化分页策略

---

## 5. 技术风险识别

| ID | 风险描述 | 概率 | 影响 | 风险等级 | 初步应对方案 |
|----|---------|------|------|---------|-------------|
| RISK-001 | 大数据量列表渲染性能问题 | 中 | 高 | 高 | 使用虚拟滚动（react-window），优化Table组件渲染 |
| RISK-002 | 表单复杂度高，维护困难 | 中 | 中 | 中 | 组件化设计，提取可复用的表单字段组件 |
| RISK-003 | 权限控制逻辑复杂，容易出错 | 低 | 高 | 中 | 使用HOC或自定义Hook封装权限检查逻辑 |
| RISK-004 | 并发编辑冲突处理不当 | 低 | 中 | 低 | 严格实现乐观锁机制，提供友好的冲突提示 |
| RISK-005 | 敏感信息泄露风险 | 低 | 高 | 中 | 严格的权限控制，敏感信息不在前端缓存 |
| RISK-006 | 浏览器兼容性问题 | 低 | 中 | 低 | 使用Polyfill，进行跨浏览器测试 |
| RISK-007 | 网络不稳定导致操作失败 | 中 | 中 | 中 | 实现请求重试机制，提供离线提示 |
| RISK-008 | 状态管理复杂度增加 | 中 | 中 | 中 | 使用React Context + Hooks，避免过度设计 |

**高风险详细说明**:

1. **RISK-001: 大数据量列表渲染性能问题**
   - 详细描述：当资源数量达到1000+时，Table组件渲染可能出现卡顿
   - 触发条件：用户查看大量资源，或者搜索/过滤结果较多
   - 影响范围：列表页用户体验，可能导致页面无响应
   - 初步建议：
     - 使用react-window实现虚拟滚动
     - 使用React.memo优化组件渲染
     - 限制单页显示数量，强制分页
     - 使用Web Worker处理数据转换

2. **RISK-005: 敏感信息泄露风险**
   - 详细描述：敏感信息（密码、密钥）可能通过前端缓存、日志、网络抓包等方式泄露
   - 触发条件：权限控制不严格，或者前端缓存敏感数据
   - 影响范围：安全性，可能导致资源被非法访问
   - 初步建议：
     - 敏感信息不在前端缓存（localStorage/sessionStorage）
     - 敏感信息不在控制台日志中输出
     - 使用HTTPS传输
     - 严格的权限检查（前端+后端双重验证）

---

## 6. 边界和约束

### 6.1 功能边界（不包括的内容）

- ❌ 资源类型的动态管理（F02-1功能，未来版本）
- ❌ 拓扑关系的可视化编辑（F04功能）
- ❌ Agent的配置和管理（F08功能）
- ❌ 任务的创建和执行（F10功能）
- ❌ 资源的批量导入/导出（未来版本）
- ❌ 资源的版本历史管理（未来版本）
- ❌ 资源的审批流程（未来版本）
- ❌ 资源的成本分析（未来版本）

### 6.2 技术约束

- **前端框架**: 必须使用React 18.x
- **UI组件库**: 必须使用Ant Design 5.x
- **类型系统**: 必须使用TypeScript 5.x，strict模式
- **构建工具**: 必须使用Vite 5.x
- **路由**: 必须使用React Router 6.x
- **HTTP客户端**: 必须使用Axios
- **测试框架**: 必须使用Vitest + React Testing Library
- **代码规范**: 必须遵循项目的ESLint + Prettier配置
- **浏览器支持**: Chrome ≥90, Firefox ≥88, Safari ≥14, Edge ≥90

### 6.3 业务约束

- **权限模型**: 只支持Owner/Viewer两级权限（MVP阶段）
- **资源类型**: 只支持6种预置类型（MVP阶段）
- **标签数量**: 每个资源最多10个标签
- **描述长度**: 最多500字符
- **名称长度**: 2-100字符
- **并发用户**: 支持至少100个并发用户
- **资源数量**: 支持至少10000个资源

### 6.4 时间约束

- **开发周期**: 预计2-3周
- **测试周期**: 预计1周
- **上线时间**: 与后端同步上线

---

## 7. 依赖关系

### 7.1 外部依赖

| 依赖 | 类型 | 提供方 | 可用性 | 风险 |
|------|------|--------|--------|------|
| 后端API | RESTful API | 后端团队 | 开发中 | 中 - API可能延期 |
| Ant Design | UI组件库 | Ant Design团队 | 已可用 | 低 - 稳定版本 |
| React | 前端框架 | React团队 | 已可用 | 低 - 稳定版本 |
| 认证服务 | JWT Token | 后端团队 | 已可用 | 低 - 已实现 |

### 7.2 内部依赖

| 依赖 | 类型 | 负责团队 | 状态 | 依赖时间 |
|------|------|---------|------|---------|
| 用户认证模块 | 前端模块 | 前端团队 | 已完成 | 开发前 |
| 权限检查模块 | 前端模块 | 前端团队 | 已完成 | 开发前 |
| 通用组件库 | 前端组件 | 前端团队 | 部分完成 | 开发中 |
| API请求封装 | 工具函数 | 前端团队 | 已完成 | 开发前 |

---

## 8. 下一步行动

- [ ] 用户已确认此澄清文档
- [ ] 进入Phase 2：需求文档编写
- [ ] 验证所有标记为"待验证"的假设
- [ ] 评估所有识别的技术风险
- [ ] 与后端团队确认API接口定义
- [ ] 与UI/UX团队确认界面设计

---

**审核签名**:
- 需求分析师: AI Assistant
- 用户确认: [待确认] - [日期]

**文档版本**: v1.0  
**最后更新**: 2024-11-30

